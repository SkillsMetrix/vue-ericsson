<script setup>
import { ref, onMounted } from "vue";
import WeatherBanner from "./WeatherBanner.vue";
import CitySearch from "./CitySearch.vue";
import CityList from "./CityList.vue";
import axios from "axios";
import { useCitiesStore } from "../../src/stores/cities";

const cityStore = useCitiesStore();

// message to display for Banner
const messageToDisplay = ref("");

const messageType = ref("Info");

const openweathermapApiKey = ref("b3aaa0b3323c0baab93aff38f75b44cb");

onMounted(() => {
  console.log("mounted");

  searchCity("mumbai");
});
const searchCity = async (inputCity) => {
  var latitude = 0.0;
  var longitude = 0.0;
  var city = "";
  var state = "";
  var country = "";
  try {
    const response = await axios.get(
      "https://api.openweathermap.org/geo/1.0/direct?q=" +
        inputCity +
        "&APPID=" +
        openweathermapApiKey.value
    );
    console.log(response.data[0].lat);
    

    latitude = response.data[0].lat;
    longitude = response.data[0].lon;
    city == response.data[0].name;
    if ("state" in response.data[0]) { state = response.data[0].state}
    country = response.data[0].country;
  } catch (error) {
    console.log(error);
    messageType.value='Error'
    messageToDisplay.value='Error...! unable to retrive data for '+ inputCity
  }
  if(city!==''){
    try{
        const response2 = await axios.get('https://api.openweathermap.org/data/2.5/weather?lat='+latitude+ '&lon='+longitude +'&units=imperial&APPID='+openweathermapApiKey.value);

        //handle success
        console.log(response2.data.main.temp);
        console.log(response2.data.main.temp_max);

        
    }catch(error){
        console.log(error);
        
    }
  }
};
</script>

<template>content</template>
